<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Playground Test Environment</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #555;
            margin-top: 0;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            font-weight: 400;
            font-size: 1rem;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        code-playground {
            margin: 15px 0;
            /* Ensure monospace font for editor and console */
            --monospace-font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }
        
        /* Additional monospace font styling for code-playground components */
        code-playground::part(editor) {
            font-family: var(--monospace-font-family);
        }
        
        code-playground::part(console) {
            font-family: var(--monospace-font-family);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® Code Playground Test Environment</h1>
        
        <div class="info">
            <strong>Interactive Testing:</strong> This page contains various configurations of the code-playground component for testing different features and behaviors.
        </div>


        <!-- Basic JavaScript Example -->
        <div class="test-section">
            <h2>1. Basic JavaScript Console Output</h2>
            <div class="controls">
                <button onclick="resetPlayground('basic-js')">Reset</button>
                <button onclick="runPlayground('basic-js')">Run</button>
            </div>
            <code-playground id="basic-js" show-line-numbers>
                <div slot="javascript">// Simple console test
console.log('Hello, World!');
console.log('Testing console output...');
console.warn('This is a warning');
console.error('This is an error');

// Test objects and arrays
const obj = { name: 'Test', value: 42 };
console.log('Object:', obj);

// Force console to be visible
setTimeout(() => {
    console.log('Delayed message');
}, 100);</div>
            </code-playground>
        </div>

        <!-- HTML + JavaScript Interactive -->
        <div class="test-section">
            <h2>2. HTML + JavaScript Interactive</h2>
            <div class="controls">
                <button onclick="resetPlayground('html-js')">Reset</button>
                <button onclick="runPlayground('html-js')">Run</button>
            </div>
            <code-playground id="html-js" show-line-numbers>
                <div slot="html">&lt;div id="counter-display"&gt;Count: 0&lt;/div&gt;&lt;div class="controls"&gt;
&lt;button onclick="increment()"&gt;Increment&lt;/button&gt;
&lt;button onclick="decrement()"&gt;Decrement&lt;/button&gt;
&lt;button onclick="resetCounter()"&gt;Reset&lt;/button&gt;&lt;/div&ht;</div>
                <div slot="javascript">let count = 0;

function updateDisplay() {
    const display = document.getElementById('counter-display');
    if (display) {
        display.textContent = `Count: ${count}`;
        console.log('Count updated to:', count);
    }
}

// Make functions globally accessible for event handlers
window.increment = function() {
    count++;
    updateDisplay();
};

window.decrement = function() {
    count--;
    updateDisplay();
};

window.resetCounter = function() {
    count = 0;
    updateDisplay();
};

// Initialize display
console.log('Counter app initialized!');
updateDisplay();</div>
            </code-playground>
        </div>

        <!-- HTML + CSS + JavaScript -->
        <div class="test-section">
            <h2>3. HTML + CSS + JavaScript (Styled)</h2>
            <div class="controls">
                <button onclick="resetPlayground('full-stack')">Reset</button>
                <button onclick="runPlayground('full-stack')">Run</button>
            </div>
            <code-playground id="full-stack" show-line-numbers layout="tabs">
                <div slot="html">&lt;div class="app"&gt;
  &lt;h2&gt;Color Picker&lt;/h2&gt;
  &lt;div class="color-box" id="colorBox"&gt;&lt;/div&gt;
  &lt;div class="controls"&gt;
    &lt;button onclick="randomColor()"&gt;Random Color&lt;/button&gt;
    &lt;button onclick="resetColor()"&gt;Reset&lt;/button&gt;
  &lt;/div&gt;
  &lt;div id="colorInfo"&gt;Current: #ff6b6b&lt;/div&gt;
&lt;/div&gt;</div>
                <div slot="css">.app {
  text-align: center;
  font-family: Arial, sans-serif;
  padding: 20px;
}

.color-box {
  width: 200px;
  height: 200px;
  background-color: #ff6b6b;
  margin: 20px auto;
  border-radius: 10px;
  border: 3px solid #333;
  transition: all 0.3s ease;
}

.controls {
  margin: 20px 0;
}

.controls button {
  background: #4ecdc4;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 0 10px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

.controls button:hover {
  background: #45b7aa;
}

#colorInfo {
  font-size: 18px;
  font-weight: bold;
  color: #333;
}</div>
                <div slot="javascript">let currentColor = '#ff6b6b';
const colorBox = document.getElementById('colorBox');
const colorInfo = document.getElementById('colorInfo');

// Make functions globally accessible
window.randomColor = function() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    currentColor = color;
    updateColor();
};

window.resetColor = function() {
    currentColor = '#ff6b6b';
    updateColor();
};

function updateColor() {
    colorBox.style.backgroundColor = currentColor;
    colorInfo.textContent = `Current: ${currentColor}`;
    console.log('Color changed to:', currentColor);
}

// Initialize
console.log('Color picker initialized with:', currentColor);
updateColor();</div>
            </code-playground>
        </div>

        <!-- Auto-run disabled -->
        <div class="test-section">
            <h2>4. Manual Run Mode (autorun=never)</h2>
            <div class="controls">
                <button onclick="resetPlayground('manual-run')">Reset</button>
                <button onclick="runPlayground('manual-run')">Run</button>
            </div>
            <code-playground id="manual-run" autorun="never" show-line-numbers>
                <div slot="javascript">// This won't auto-run - press the Run button!
console.log('This code requires manual execution');
console.log('Edit me and press Run to see changes');

for (let i = 1; i <= 5; i++) {
    console.log(`Loop iteration ${i}`);
}</div>
            </code-playground>
        </div>

        <!-- Performance Test -->
        <div class="test-section">
            <h2>5. Performance & Timing Test</h2>
            <div class="controls">
                <button onclick="resetPlayground('performance')">Reset</button>
                <button onclick="runPlayground('performance')">Run</button>
            </div>
            <code-playground id="performance" show-line-numbers>
                <div slot="javascript">// Performance testing
console.time('fibonacci');

function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log('Calculating fibonacci(30)...');
const result = fibonacci(30);
console.log('Result:', result);
console.timeEnd('fibonacci');

// Memory usage test
const largeArray = new Array(1000000).fill(0).map((_, i) => i);
console.log('Created array with', largeArray.length, 'elements');
console.log('Sample values:', largeArray.slice(0, 10));</div>
            </code-playground>
        </div>

        <!-- Error Handling -->
        <div class="test-section">
            <h2>6. Error Handling Test - Test 6 Errors Should Stay Here</h2>
            <div class="info">
                <strong>Console Isolation Test:</strong> This test creates async errors that should appear in THIS console, not in other playgrounds on the page.
            </div>
            <div class="controls">
                <button onclick="resetPlayground('error-test')">Reset</button>
                <button onclick="runPlayground('error-test')">Run</button>
            </div>
            <code-playground id="error-test" show-line-numbers>
                <div slot="javascript">console.log('=== TEST 6 ERROR HANDLING ===');
console.log('This playground is Test 6');

try {
    console.log('This will work fine');
    
    // This will cause an error
    nonExistentFunction();
} catch (error) {
    console.error('Caught error:', error.message);
}

// This will cause an uncaught error - it should appear HERE, not in other playgrounds
setTimeout(() => {
    console.log('Test 6: About to throw async error...');
    throw new Error('TEST 6 UNCAUGHT ERROR - should appear in Test 6 console only!');
}, 500);</div>
            </code-playground>
        </div>

        <!-- Compact Width Test (Default) -->
        <div class="test-section">
            <h2>7. Compact Width Test - Default (80 chars)</h2>
            <div class="controls">
                <button onclick="resetPlayground('compact-default')">Reset</button>
                <button onclick="runPlayground('compact-default')">Run</button>
            </div>
            <code-playground id="compact-default" show-line-numbers>
                <div slot="javascript">console.log('Testing default compact width (80 chars)...');

// Test very simple objects to debug compact mode
const tiny = { a: 1 };
console.log('Tiny object (should be compact):', tiny);

const small = { x: 5, y: 10 };
console.log('Small object (should be compact):', small);

// Test short object (should be compact)
const shortObj = { a: 1, b: 2, c: 3 };
console.log('Short object:', shortObj);

// Test medium object (might be compact or expanded depending on content)
const mediumObj = { name: 'John', age: 30, city: 'New York', email: 'john@example.com' };
console.log('Medium object:', mediumObj);

// Test long object (should be expanded)
const longObj = {
    firstName: 'VeryLongFirstName',
    lastName: 'VeryLongLastName',
    email: 'very.long.email.address@example.com',
    address: {
        street: '123 Very Long Street Name',
        city: 'Very Long City Name',
        zipCode: '12345-6789'
    },
    preferences: ['option1', 'option2', 'option3', 'option4']
};
console.log('Long object:', longObj);

// Test arrays
const shortArray = [1, 2, 3];
const longArray = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];
console.log('Short array:', shortArray);
console.log('Long array:', longArray);</div>
            </code-playground>
        </div>

        <!-- Compact Width Test (40 chars) -->
        <div class="test-section">
            <h2>8. Compact Width Test - 40 Characters</h2>
            <div class="controls">
                <button onclick="resetPlayground('compact-40')">Reset</button>
                <button onclick="runPlayground('compact-40')">Run</button>
                <button onclick="toggleCompactWidth('compact-40', 40)">Set 40 chars</button>
                <button onclick="toggleCompactWidth('compact-40', 80)">Reset to 80 chars</button>
            </div>
            <code-playground id="compact-40" compact-width="40" show-line-numbers>
                <div slot="javascript">console.log('Testing 40-character compact width...');

// Test EXACT threshold boundaries
// "Test 40: {key: "abcdefghijklmnop"}" = 35 chars currently
// Need exactly 40 and 41, so need 5 and 6 more characters
// "Test 40: " = 9 chars, {key: ""} = 8 chars base, so 17 chars base total
// For 40 chars: need 23 char value (40 - 17 = 23)
// For 41 chars: need 24 char value (41 - 17 = 24)

const exactly40 = { key: "abcdefghijklmnopqrstuv" }; // 23 chars + 17 base = exactly 40 total
const exactly41 = { key: "abcdefghijklmnopqrstuvw" }; // 24 chars + 17 base = exactly 41 total

console.log('=== BOUNDARY TESTS ===');
console.log('Test 40:', exactly40);
console.log('Test 41:', exactly41);

// Test arrays too - "Array40: " = 9 chars prefix
// Need arrays that total exactly 40 and 41 chars
// "Array40: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]" 
// Let me count: "Array40: " = 9, "[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]" = ?
// For exactly 40: need 31 chars for array part
// For exactly 41: need 32 chars for array part

const array40 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; // Should total exactly 40
const array43 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; // Should total exactly 43

console.log('Array40:', array40);
console.log('Array43:', array43);

console.log('=== OTHER TESTS ===');
// Same objects as before, but with 40-char threshold
const shortObj = { a: 1, b: 2, c: 3 };
console.log('Short object:', shortObj);

const mediumObj = { name: 'John', age: 30, city: 'New York' };
console.log('Medium object:', mediumObj);

const longObj = {
    firstName: 'VeryLongFirstName',
    lastName: 'VeryLongLastName',
    email: 'very.long.email@example.com'
};
console.log('Long object:', longObj);</div>
            </code-playground>
        </div>

        <!-- Compact Width Test (120 chars) -->
        <div class="test-section">
            <h2>9. Compact Width Test - 120 Characters</h2>
            <div class="controls">
                <button onclick="resetPlayground('compact-120')">Reset</button>
                <button onclick="runPlayground('compact-120')">Run</button>
                <button onclick="toggleCompactWidth('compact-120', 120)">Set 120 chars</button>
                <button onclick="toggleCompactWidth('compact-120', 80)">Reset to 80 chars</button>
            </div>
            <code-playground id="compact-120" compact-width="120" show-line-numbers>
                <div slot="javascript">console.log('Testing 120-character compact width...');

// Same objects, but with more generous 120-char threshold
const shortObj = { a: 1, b: 2, c: 3 };
console.log('Short object:', shortObj);

const mediumObj = { name: 'John', age: 30, city: 'New York', email: 'john@example.com', phone: '555-1234' };
console.log('Medium object:', mediumObj);

const longObj = {
    firstName: 'VeryLongFirstName',
    lastName: 'VeryLongLastName',
    email: 'very.long.email.address@example.com',
    address: { street: '123 Very Long Street Name', city: 'Very Long City Name' }
};
console.log('Long object:', longObj);

// Arrays with 120-char threshold - more items should fit in compact mode
const shortArray = [1, 2, 3, 4, 5];
const mediumArray = Array.from({length: 20}, (_, i) => i + 1);
const longArray = Array.from({length: 50}, (_, i) => i + 1);
console.log('Short array:', shortArray);
console.log('Medium array:', mediumArray);
console.log('Long array:', longArray);</div>
            </code-playground>
        </div>

        <!-- Dynamic Compact Width Test -->
        <div class="test-section">
            <h2>10. Dynamic Compact Width Test</h2>
            <div class="info">
                Use the controls to dynamically change the compact width and see how the same objects are displayed differently.
            </div>
            <div class="controls">
                <button onclick="resetPlayground('dynamic-compact')">Reset</button>
                <button onclick="runPlayground('dynamic-compact')">Run</button>
                <button onclick="setDynamicCompactWidth(30)">30 chars</button>
                <button onclick="setDynamicCompactWidth(60)">60 chars</button>
                <button onclick="setDynamicCompactWidth(100)">100 chars</button>
                <button onclick="setDynamicCompactWidth(150)">150 chars</button>
            </div>
            <code-playground id="dynamic-compact" show-line-numbers>
                <div slot="javascript">console.log('Dynamic compact width test...');

window.testObjects = function() {
    console.clear();
    const playground = document.getElementById('dynamic-compact');
    const currentWidth = playground ? playground.compactWidth : 80;
    console.log('=== Current compact width:', currentWidth, 'characters ===');
    
    // Test various objects and arrays
    const examples = [
        { name: 'tiny', data: { a: 1 } },
        { name: 'small', data: { name: 'John', age: 30 } },
        { name: 'medium', data: { name: 'John Doe', age: 30, city: 'New York', email: 'john@example.com' } },
        { name: 'large', data: { 
            firstName: 'John', 
            lastName: 'Doe', 
            email: 'john.doe@example.com',
            address: { street: '123 Main St', city: 'New York', state: 'NY' },
            preferences: ['reading', 'coding', 'music']
        }},
        { name: 'tiny array', data: [1, 2, 3] },
        { name: 'small array', data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] },
        { name: 'medium array', data: Array.from({length: 20}, (_, i) => i + 1) },
        { name: 'large array', data: Array.from({length: 40}, (_, i) => `item${i}`) }
    ];
    
    examples.forEach(example => {
        console.log(`${example.name}:`, example.data);
    });
};

// Make function globally accessible
window.testObjects();</div>
            </code-playground>
        </div>
    </div>

    <!-- Load the component -->
    <script type="module" src="./build/code-playground.js"></script>
    
    <!-- CodeMirror for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/mode/css/css.min.js"></script>

    <script>
        // Helper functions for testing
        function resetPlayground(id) {
            const playground = document.getElementById(id);
            if (playground) {
                playground.reset();
            }
        }

        function runPlayground(id) {
            const playground = document.getElementById(id);
            if (playground) {
                playground.run();
            }
        }

        function toggleCompactWidth(id, width) {
            const playground = document.getElementById(id);
            if (playground) {
                playground.compactWidth = width;
                console.log(`Set compact width to ${width} characters for ${id}`);
                // Re-run to see the effect
                playground.run();
            }
        }

        function setDynamicCompactWidth(width) {
            const playground = document.getElementById('dynamic-compact');
            if (playground) {
                playground.compactWidth = width;
                // Re-run the test function to show the difference
                if (window.testObjects) {
                    window.testObjects();
                }
            }
        }

        function debugConsole() {
            const playground = document.getElementById('debug-console');
            if (playground) {
                console.log('=== DEBUG CONSOLE INFO ===');
                console.log('Playground element:', playground);
                console.log('Shadow root:', playground.shadowRoot);
                
                if (playground.shadowRoot) {
                    const consoleElement = playground.shadowRoot.querySelector('.__code-playground-console');
                    console.log('Console element:', consoleElement);
                    console.log('Console element visible:', consoleElement?.classList.contains('visible'));
                    console.log('Console element content:', consoleElement?.innerHTML);
                    
                    const resultElement = playground.shadowRoot.querySelector('.__code-playground-result');
                    console.log('Result element:', resultElement);
                    
                    // Try to force create console
                    const pseudoConsole = playground.pseudoConsole;
                    console.log('PseudoConsole:', pseudoConsole);
                    
                    // Test direct call
                    pseudoConsole.log('DIRECT TEST MESSAGE');
                    
                    // Check again after direct call
                    setTimeout(() => {
                        const consoleElement2 = playground.shadowRoot.querySelector('.__code-playground-console');
                        console.log('Console element after direct call:', consoleElement2);
                        console.log('Console element visible after direct call:', consoleElement2?.classList.contains('visible'));
                        console.log('Console element content after direct call:', consoleElement2?.innerHTML);
                    }, 500);
                }
                
                console.log('=== END DEBUG ===');
            }
        }

        // Log when components are ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Test playground loaded');
            
            // Wait for custom elements to be defined
            customElements.whenDefined('code-playground').then(() => {
                console.log('code-playground component is ready');
            });
        });
    </script>
</body>
</html>